{% extends "base.html" %}

{% block content %}
<div class="container py-5">
    <div class="row">
        <!-- Profile Sidebar -->
        <div class="col-lg-3">
            <div class="card mb-4">
                <div class="card-body text-center">
                    <img src="https://via.placeholder.com/150" class="rounded-circle mb-3" alt="Profile Picture">
                    <h5 class="card-title mb-0" id="profileUsername">{{ current_user.username }}</h5>
                    <p class="text-muted small mb-0" id="profileEmail">{{ current_user.email }}</p>
                    <div class="mt-3">
                        <p class="mb-0"><strong>Saved Domains:</strong> <span id="favoritesCount">{{ favorites|length }}</span></p>
                        <p class="mb-0"><strong>Watched Domains:</strong> <span id="watchlistCount">{{ watchlist|length if watchlist else 0 }}</span></p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="col-lg-9">
            <div class="card">
                <div class="card-header">
                    <!-- Navigation tabs -->
                    <ul class="nav nav-tabs card-header-tabs">
                        <li class="nav-item">
                            <a class="nav-link active" id="favorites-tab" data-bs-toggle="tab" href="#favorites">My Favorites</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" id="watchlist-tab" data-bs-toggle="tab" href="#watchlist">Domain Watchlist</a>
                        </li>
                    </ul>
                </div>
                
                <div class="card-body">
                    <div class="tab-content">
                        <!-- Favorites Tab -->
                        <div class="tab-pane fade show active" id="favorites">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h5 class="mb-0">Available Domains</h5>
                                <div class="btn-group">
                                    <button class="btn btn-sm btn-outline-secondary" data-sort="name">Sort by Name</button>
                                    <button class="btn btn-sm btn-outline-secondary" data-sort="score">Sort by Score</button>
                                    <button class="btn btn-sm btn-outline-secondary" data-sort="date">Sort by Date</button>
                                </div>
                            </div>
                            <div class="favorites-list row">
                                {% for favorite in favorites %}
                                <div class="col-md-6 mb-4" 
                                     data-favorite-id="{{ favorite.id }}"
                                     data-name="{{ favorite.domain_name }}" 
                                     data-score="{{ favorite.total_score }}" 
                                     data-date="{{ favorite.formatted_date }}">
                                    <div class="domain-card">
                                        <div class="d-flex justify-content-between align-items-center mb-3">
                                            <h5 class="mb-0">{{ favorite.domain_name }}.{{ favorite.domain_extension }}</h5>
                                            <span class="badge bg-primary">{{ favorite.price }}</span>
                                        </div>
                                        
                                        <div class="domain-score">
                                            <div class="score-circle-container d-flex justify-content-center align-items-center mb-3">
                                                <div class="score-circle" style="--score-value: {{ favorite.total_score }}">
                                                    <div class="score-circle-inner">
                                                        <span class="score-value">{{ favorite.total_score }}</span>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <div class="score-details">
                                                <div class="score-item d-flex align-items-center mb-1">
                                                    <div class="score-bar-container flex-grow-1">
                                                        <div class="score-bar" style="width: {{ favorite.length_score }}%"></div>
                                                    </div>
                                                    <small class="ms-2">Length</small>
                                                </div>
                                                <div class="score-item d-flex align-items-center mb-1">
                                                    <div class="score-bar-container flex-grow-1">
                                                        <div class="score-bar" style="width: {{ favorite.dictionary_score }}%"></div>
                                                    </div>
                                                    <small class="ms-2">Dictionary</small>
                                                </div>
                                                <div class="score-item d-flex align-items-center mb-1">
                                                    <div class="score-bar-container flex-grow-1">
                                                        <div class="score-bar" style="width: {{ favorite.pronounceability_score }}%"></div>
                                                    </div>
                                                    <small class="ms-2">Pronounceability</small>
                                                </div>
                                                <div class="score-item d-flex align-items-center mb-1">
                                                    <div class="score-bar-container flex-grow-1">
                                                        <div class="score-bar" style="width: {{ favorite.repetition_score }}%"></div>
                                                    </div>
                                                    <small class="ms-2">Repetition</small>
                                                </div>
                                                <div class="score-item d-flex align-items-center mb-1">
                                                    <div class="score-bar-container flex-grow-1">
                                                        <div class="score-bar" style="width: {{ favorite.tld_score }}%"></div>
                                                    </div>
                                                    <small class="ms-2">TLD</small>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="mt-3">
                                            <a href="https://domains.google.com/registrar/search?searchTerm={{ favorite.domain_name }}.{{ favorite.domain_extension }}" 
                                               target="_blank" 
                                               class="btn btn-sm btn-outline-primary w-100">Register Domain</a>
                                        </div>
                                        
                                        <button class="btn btn-sm btn-outline-danger w-100 mt-2" 
                                                onclick="deleteFavorite({{ favorite.id }})">
                                            Remove from Favorites
                                        </button>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                        </div>

                        <!-- Watchlist Tab -->
                        <div class="tab-pane fade" id="watchlist">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h5 class="mb-0">Watched Domains</h5>
                                <div class="btn-group">
                                    <button class="btn btn-sm btn-outline-secondary" data-sort="name">Sort by Name</button>
                                    <button class="btn btn-sm btn-outline-secondary" data-sort="date">Sort by Date</button>
                                    <button class="btn btn-sm btn-outline-secondary" data-sort="status">Sort by Status</button>
                                </div>
                            </div>
                            <div class="watchlist-list row">
                                {% for domain in watchlist %}
                                <div class="col-md-6 mb-4" 
                                     data-watchlist-id="{{ domain.id }}"
                                     data-name="{{ domain.domain_name }}" 
                                     data-date="{{ domain.formatted_date }}"
                                     data-status="{{ domain.status }}">
                                    <div class="domain-card">
                                        <div class="d-flex justify-content-between align-items-center mb-3">
                                            <h5 class="mb-0">{{ domain.domain_name }}.{{ domain.domain_extension }}</h5>
                                            <span class="badge {% if domain.status == 'available' %}bg-success{% else %}bg-secondary{% endif %}">
                                                {{ domain.status|title }}
                                            </span>
                                        </div>
                                        
                                        <div class="text-muted small mb-3">
                                            <div>Added: {{ domain.formatted_date }}</div>
                                            <div>Last checked: {{ domain.last_checked_date }}</div>
                                        </div>

                                        <div class="d-flex gap-2">
                                            {% if domain.status == 'available' %}
                                            <a href="https://domains.google.com/registrar/search?searchTerm={{ domain.domain_name }}.{{ domain.domain_extension }}" 
                                               target="_blank" 
                                               class="btn btn-sm btn-success flex-grow-1">Register Now</a>
                                            {% endif %}
                                            <button class="btn btn-sm btn-outline-danger" 
                                                    onclick="removeFromWatchlist({{ domain.id }})">
                                                Remove
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// The JavaScript for this page is now handled by main.js
</script>
{% endblock %}